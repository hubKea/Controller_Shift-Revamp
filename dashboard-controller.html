<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<title>Controller Dashboard - Thinkers Afrika</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
      :root {
        --primary-500: #137fec;
        --neutral-50: #f8fafc;
        --neutral-100: #f1f5f9;
        --neutral-200: #e2e8f0;
        --neutral-300: #cbd5e1;
        --neutral-400: #94a3b8;
        --neutral-500: #64748b;
        --neutral-600: #475569;
        --neutral-700: #334155;
        --neutral-800: #1e293b;
        --neutral-900: #0f172a;
        --green-50: #f0fdf4;
        --green-100: #dcfce7;
        --green-500: #22c55e;
        --green-700: #15803d;
        --yellow-50: #fefce8;
        --yellow-100: #fef08a;
        --yellow-500: #eab308;
        --yellow-700: #a16207;
        --red-50: #fef2f2;
        --red-100: #fee2e2;
        --red-500: #ef4444;
        --red-700: #b91c1c;
        --blue-50: #eff6ff;
        --blue-100: #dbeafe;
        --blue-500: #3b82f6;
        --blue-700: #1d4ed8;
      }
      .material-symbols-outlined {
        font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24
      }
    </style>
</head>
<body class="bg-neutral-50 text-neutral-800" style='font-family: Inter, "Noto Sans", sans-serif;'>
<div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
<header class="sticky top-0 z-20 flex items-center justify-between whitespace-nowrap border-b border-neutral-200 bg-neutral-50 px-10 py-3">
<div class="flex items-center gap-8">
<div class="flex items-center gap-3 text-neutral-900">
<div class="h-8 w-8">
  <img src="ThinkersAfrica_Logo.jpeg" alt="ThinkersAfrica Logo" class="h-full w-full object-contain" />
</div>
<h1 class="text-xl font-bold">Thinkers Afrika</h1>
</div>
<nav class="flex items-center gap-6">
<a class="text-sm font-bold text-primary-500 border-b-2 border-primary-500 pb-1" href="dashboard-controller.html">Dashboard</a>
</nav>
</div>
<div class="flex items-center gap-4">
<button id="messagesButton" type="button" class="relative flex h-10 w-10 items-center justify-center rounded-full text-neutral-500 transition-colors hover:bg-neutral-100 hover:text-neutral-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2" aria-label="Messages">
<span class="material-symbols-outlined">chat</span>
<span id="messagesUnreadBadge" class="pointer-events-none absolute -top-1.5 -right-1.5 hidden min-w-[1.5rem] rounded-full bg-red-500 px-1.5 py-0.5 text-center text-xs font-semibold leading-none text-white" aria-live="polite" aria-atomic="true"></span>
</button>
<button class="relative rounded-full p-2 text-neutral-500 hover:bg-neutral-100 hover:text-neutral-700">
<span class="material-symbols-outlined"> notifications </span>
</button>
<div class="h-10 w-10 rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD28RCrVpF_Mrb_Y6VHsI2u1sA9eBWp8y9HSHNYJhfCxci4Kf0pJ5gaWTdr3ZlOEwoi1SxQ3sxgCCqLC0ZM-LLM_v6MiXWJvsE-hTkq3A-4wrskcypnIufVE_uORyF3J0rSt_YT0JcM1GVFtqHnL0-t5h0m5ekjuyhHnu_qP0pPpVL76uOxU5ARZw8j9OPLrGBEA658oPxOweg5bQkfF2IL9n0AY1vJlDe35WqqH8avF3j00z7-LqcMGVXLkbLmzZR4gNhVm2IqEK_O");'></div>
</div>
</header>
<main class="flex-1 bg-neutral-100 px-10 py-8">
<div class="mx-auto max-w-7xl">
<div class="mb-8 flex items-center justify-between">
<h2 class="text-3xl font-bold tracking-tight text-neutral-900">Shift Reports</h2>
<a href="report-form.html" class="flex items-center justify-center gap-2 rounded-[12px] border border-neutral-800 bg-transparent px-4 py-2 text-sm font-semibold text-neutral-800 transition-colors hover:bg-neutral-800 hover:text-white">
<span class="material-symbols-outlined"> add </span>
<span>Create New Report</span>
</a>
</div>
<div class="mb-6 rounded-lg border border-gray-200 bg-white p-6">
<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
<div>
<label class="block text-sm font-medium text-gray-700" for="date-range">Date Range</label>
<input class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" id="date-range" name="date-range" placeholder="Select Date Range" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700" for="controller">Controller</label>
<select class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" id="controller" name="controller">
<option>All Controllers</option>
<!-- Dynamic options will be populated here by JavaScript -->
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700" for="status">Status</label>
<select class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" id="status" name="status">
<option>All Statuses</option>
<option value="draft">Draft</option>
<option value="submitted">Pending Review</option>
<option value="under_review">Under Review</option>
<option value="approved">Approved</option>
<option value="rejected">Rejected</option>
</select>
</div>
<div class="flex flex-col gap-2 self-end sm:flex-row">
<button id="filter-clear" class="flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm transition-colors hover:bg-gray-50" type="button">
<span class="material-symbols-outlined">clear_all</span>
<span>Clear Filters</span>
</button>
<button id="filter-apply" class="flex w-full items-center justify-center gap-2 rounded-lg border border-transparent bg-gray-800 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-gray-700" type="button">
<span class="material-symbols-outlined"> filter_list </span>
<span>Apply Filters</span>
</button>
</div>
</div>
<div id="filters-active-indicator" class="mt-4 text-sm text-blue-600 hidden">
Filters active
</div>
</div>
<div class="overflow-hidden rounded-lg border border-neutral-200 bg-white">
<div class="relative overflow-x-auto">
<table class="w-full">
<thead class="sticky top-0 z-10 bg-neutral-100">
<tr>
<th class="px-6 py-4 text-left text-xs font-medium uppercase tracking-wider text-neutral-500">Date</th>
<th class="px-6 py-4 text-left text-xs font-medium uppercase tracking-wider text-neutral-500">Site</th>
<th class="px-6 py-4 text-left text-xs font-medium uppercase tracking-wider text-neutral-500">Status</th>
<th class="px-6 py-4 text-left text-xs font-medium uppercase tracking-wider text-neutral-500">Controller on Shift</th>
<th class="px-6 py-4 text-right text-xs font-medium uppercase tracking-wider text-neutral-500">Actions</th>
</tr>
</thead>
         <tbody id="reports-table-body" class="divide-y divide-neutral-200">
         <!-- Dynamic content will be populated here by JavaScript -->
         </tbody>
</table>
</div>
</div>
</div>
</main>
</div>

  <!-- Firebase Services -->
  <script type="module" src="firebase-config.js"></script>
  <script type="module" src="js/user-service.js"></script>
  <script type="module" src="js/enhanced-report-service.js"></script>
  <script type="module" src="js/data-model.js"></script>
  <script type="module" src="js/app.js"></script>

  <!-- Dashboard Controller Script -->
  <script type="module">
    import { DashboardController } from "./js/dashboard-controller.js";

    document.addEventListener("DOMContentLoaded", () => {
      window.dashboardController = new DashboardController();
    });
  </script>
  <script type="module">
    import { userService } from "./js/user-service.js";
    import { subscribeUserConversations } from "./js/messages-service.js";

    const messagesButton = document.getElementById("messagesButton");
    const unreadBadge = document.getElementById("messagesUnreadBadge");

    if (messagesButton && unreadBadge) {
      const navigateToMessages = () => {
        window.location.href = "messages.html";
      };

      messagesButton.addEventListener("click", navigateToMessages);
      messagesButton.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          navigateToMessages();
        }
      });

      const updateBadge = (totalUnread) => {
        if (totalUnread > 0) {
          unreadBadge.textContent = String(totalUnread);
          unreadBadge.classList.remove("hidden");
        } else {
          unreadBadge.textContent = "";
          unreadBadge.classList.add("hidden");
        }
      };

      let unsubscribe = null;

      const attachSubscription = (uid) => {
        if (unsubscribe) {
          unsubscribe();
          unsubscribe = null;
        }
        if (!uid) {
          updateBadge(0);
          return;
        }
        unsubscribe = subscribeUserConversations(uid, (conversations) => {
          const total = Array.isArray(conversations)
            ? conversations.reduce((acc, conversation) => {
                const count = conversation?.unreadCount?.[uid];
                return acc + (typeof count === "number" ? count : 0);
              }, 0)
            : 0;
          updateBadge(total);
        });
      };

      const previousHandler =
        typeof userService.onAuthStateChange === "function"
          ? userService.onAuthStateChange.bind(userService)
          : null;

      userService.onAuthStateChange = (user, role, permissions) => {
        if (typeof previousHandler === "function") {
          try {
            previousHandler(user, role, permissions);
          } catch (error) {
            console.warn("[messages-nav] previous auth handler failed", error);
          }
        }
        attachSubscription(user && user.uid ? user.uid : "");
      };

      const current = typeof userService.getCurrentUser === "function" ? userService.getCurrentUser() : null;
      if (current?.isAuthenticated && current.user?.uid) {
        attachSubscription(current.user.uid);
      }

      window.addEventListener("beforeunload", () => {
        if (typeof unsubscribe === "function") {
          unsubscribe();
          unsubscribe = null;
        }
      });
    }
  </script>
</body></html>










